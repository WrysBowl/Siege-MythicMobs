
#########################################################
## Developed by Little Room, patreon.com/littleroomdev ##
#########################################################

##### SOUNDS #####
tiamat_idlesounds:
  Skills:
  - randomskill{skills=tiamatidle1,tiamatidle2,tiamatidle3} @self
  
tiamatidle1:
  Skills:
  - sound{s=littleroom_tiamat:littleroom.tiamat.idle1;v=1;sc=HOSTILE} @self
  
tiamatidle2:
  Skills:
  - sound{s=littleroom_tiamat:littleroom.tiamat.idle2;v=1;sc=HOSTILE} @self
  
tiamatidle3:
  Skills:
  - sound{s=littleroom_tiamat:littleroom.tiamat.snarl;v=1;sc=HOSTILE} @self
  
  
tiamatpillar1:
  Skills:
  - sound{s=littleroom_tiamat:littleroom.tiamat.pillar1;v=1;sc=HOSTILE} @self
  
tiamatpillar2:
  Skills:
  - sound{s=littleroom_tiamat:littleroom.tiamat.pillar2;v=1;sc=HOSTILE} @self
  
tiamatpillar3:
  Skills:
  - sound{s=littleroom_tiamat:littleroom.tiamat.pillar3;v=1;sc=HOSTILE} @self
  
tiamatpillar4:
  Skills:
  - sound{s=littleroom_tiamat:littleroom.tiamat.pillar4;v=1;sc=HOSTILE} @self
  
  
tiamat_attacksounds:
  Skills:
  - randomskill{skills=tiamatattack1,tiamatattack2,tiamatattack3} @self
  
tiamatattack1:
  Skills:
  - sound{s=littleroom_tiamat:littleroom.tiamat.attack1;v=1;sc=HOSTILE} @self
  
tiamatattack2:
  Skills:
  - sound{s=littleroom_tiamat:littleroom.tiamat.attack2;v=1;sc=HOSTILE} @self
  
tiamatattack3:
  Skills:
  - sound{s=littleroom_tiamat:littleroom.tiamat.attack3;v=1;sc=HOSTILE} @self

###### SLEEPING ######

tiamat_HANGING:
  Skills:
  - delay 1
  - remove @EIR{r=8}
  - teleport{spreadh=0;spreadv=0} @selflocation{y=-5}
  - summon{t=tiamatAWAKENmarker} @selflocation{y=-5}
  - setAI{ai=false} @self
  - setstance{stance=sleep} @self
  - DefaultState{m=tiamat;t=IDLE;s=hanging_idle} @self
  
tiamatAWAKENSIGNAL:
  Conditions:
  - playerwithin{d=6} true
  Skills:
  - signal{s=WAKEUP} @Parent
  - remove @self
  
tiamat_HANGING_AWAKEN:
  Cooldown: 666
  Skills:
  - gcd{ticks=100}
  - setAI{ai=true} @self
  - state{s=hanging_drop} @self
  - teleport{spreadh=0;spreadv=0} @selflocation{y=-.25}
  - delay 10
  - potion{type=SLOW_FALLING;duration=60;level=4}
  - delay 10
  - sound{s=littleroom_tiamat:littleroom.tiamat.wingflap1;v=1;sc=HOSTILE} @self
  - delay 30
  - setstance{stance=inair} @self
  
  
tiamat_FLAP:
  Cooldown: 1
  TargetConditions:
  - blocktype{type=air} true
  Conditions:
  - stance{s=inair} true
  Skills:
  - state{s=hanging_drop_flap} @self
  - delay 5
  - sound{s=littleroom_tiamat:littleroom.tiamat.wingflap2;v=1;sc=HOSTILE} @self
  - lunge{velocity=.1;velocityY=3} @target
  
tiamat_LAND:
  Cooldown: 666
  Conditions:
  - stance{s=inair} true
  - onground true
  Skills:
  - sound{s=littleroom_tiamat:littleroom.tiamat.land;v=1;sc=HOSTILE} @self
  - state{s=hanging_drop_flap;r=true} @self
  - gcd{ticks=30} @self
  - setstance{stance=ground} @self
  - state{s=hanging_drop_land} @self
  - delay 20
  - DefaultState{m=tiamat;t=IDLE;s=idle} @self
  
##### COMBAT #####


tiamatSWIPEleftsync:
  Skills:
  - CancelEvent
  - Skill{s=tiamatSWIPEleft} @self
  
tiamatSWIPEleft:
  Cooldown: 2
  Conditions:
  - offgcd true
  - onground true
  - incombat true
  Skills:
  - gcd{ticks=20} @self
  - state{s=ground_swipe} @self
  - delay 5
  - skill{s=tiamat_attacksounds} @self
  - lunge{velocity=1;velocityY=.2} @target
  - delay 8
  - totem{oT=tiamatSWIPEFX;oH=tiamatSWIPEDMG;int=1;hR=2;md=2;hnp=false;repeat=10;repeatInterval=1} @ModelPart{m=tiamat;p=left_hand}
  
tiamatSWIPEDMG:
  Skills:
  - damage{a=6}
  
tiamatSWIPEFX:
  Skills:
  - signal{s=BREAK} @EIR{r=3}
  - effect:particles{particle=squid_ink;amount=5;hS=.25;vS=.25}
  - effect:particles{particle=dragon_breath;amount=3;hS=.25;vS=.25}
  - skill{s=tiamatSWIPEgroundFX} @origin
  
tiamatSWIPEgroundFX:
  TargetConditions:
  - blocktype{type=air} false
  Skills:
  - effect:particles{particle=campfire_cosy_smoke;amount=5;hS=.25;vS=.25}
  
  
tiamatSWIPErightsync:
  Skills:
  - CancelEvent
  - Skill{s=tiamatSWIPEright} @self
  
tiamatSWIPEright:
  Cooldown: 2
  Conditions:
  - offgcd true
  - onground true
  - incombat true
  Skills:
  - gcd{ticks=20} @self
  - state{s=ground_swipe2} @self
  - delay 5
  - skill{s=tiamat_attacksounds} @self
  - lunge{velocity=1;velocityY=.2} @target
  - delay 8
  - totem{oT=tiamatSWIPEFX;oH=tiamatSWIPEDMG;int=1;hR=2;md=2;hnp=false;repeat=10;repeatInterval=1} @ModelPart{m=tiamat;p=right_hand}
  
tiamatLEAP:
  Cooldown: 6
  Conditions:
  - offgcd true
  - onground true
  - incombat true
  Skills:
  - gcd{ticks=20} @self
  - setspeed{speed=0;type=walking} @self
  - state{s=ground_leap} @self
  - delay 10
  - signal{s=BREAK;repeat=20;repeatInterval=1} @EIR{r=3}
  - effect:particles{p=squid_ink;amount=5;speed=0;hS=1;vS=1;repeat=10;repeatInterval=1}
  - skill{s=tiamat_attacksounds} @self
  - lunge{velocity=4;velocityY=.1} @target
  - setspeed{speed=1;type=walking} @self
  - delay 2  
  - sound{s=littleroom_tiamat:littleroom.tiamat.leap;v=1;sc=HOSTILE} @self
  - damage{a=5;repeat=4;repeatInterval=1} @PIR{r=5}
  - throw{velocity=1;velocityY=8;repeat=4;repeatInterval=4} @PIR{r=5}
  
  
  
tiamatRAGE:
  Cooldown: 25
  Conditions:
  - offgcd true
  - onground true
  - incombat true
  Skills:
  - sound{s=littleroom_tiamat:littleroom.tiamat.roar;v=1;sc=HOSTILE} @self
  - gcd{ticks=40} @self
  - setAI{ai=false} @self
  - state{s=ground_rage} @self
  - delay 10
  - signal{s=BREAK} @EIR{r=6}
  - skill{s=tiamatRAGEFX} @pir{r=16}
  - effect:particles{particle=falling_water;amount=1;hS=.1;vS=.1;repeat=4;repeatInterval=5} @ModelPart{m=tiamat;p=head}
  - effect:particles{particle=splash;amount=5;hS=.1;vS=.1;repeat=2;repeatInterval=5} @ModelPart{m=tiamat;p=jaw}
  - delay 5
  - summon{t=tiamatSWARM} @self
  - effect:particles{particle=campfire_cosy_smoke;amount=1;hS=.2;vS=.2;repeat=10;repeatInterval=1;d=true;dir=0,1,0;speed=.2} @ModelPart{m=tiamat;p=jaw;offset=LOCAL;z=.75;y=.1}
  - delay 25
  - setAI{ai=true} @self
  
  
tiamatRAGEFX:
  Skills:  
  - potion{type=SLOW;duration=60;level=1;p=false;i=false} @pir{r=16}
  - throw{velocity=15;velocityY=2} @pir{r=8}
  - recoil{r=1;pitch=-3to-3} @pir{r=16}
  - delay 1
  - recoil{r=1;pitch=3to3} @pir{r=16}
  - delay 1
  - recoil{r=1;pitch=-3to-3} @pir{r=16}
  - delay 1
  - recoil{r=1;pitch=3to3} @pir{r=16}
  - delay 1
  - recoil{r=1;pitch=-2to-2} @pir{r=16}
  - delay 1
  - recoil{r=1;pitch=2to2} @pir{r=16}
  - delay 1
  - recoil{r=1;pitch=-2to-2} @pir{r=16}
  - delay 1
  - recoil{r=1;pitch=2to2} @pir{r=16}
  - delay 1
  - recoil{r=1;pitch=-1to-1} @pir{r=16}
  - delay 1
  - recoil{r=1;pitch=1to1} @pir{r=16}
  - delay 1
  - recoil{r=1;pitch=-1to-1} @pir{r=16}
  - delay 1
  - recoil{r=1;pitch=1to1} @pir{r=16}
  - delay 1
  - recoil{r=1;pitch=-1to-1} @pir{r=16}
  - delay 1
  - recoil{r=1;pitch=1to1} @pir{r=16}
  - delay 1
  - recoil{r=1;pitch=-1to-1} @pir{r=16}
  - delay 1
  - recoil{r=1;pitch=1to1} @pir{r=16}
  - delay 1
  - recoil{r=1;pitch=-1to-1} @pir{r=16}
  - delay 1
  - recoil{r=1;pitch=1to1} @pir{r=16}
  - delay 1
  - recoil{r=1;pitch=-1to-1} @pir{r=16}
  - delay 1
  - recoil{r=1;pitch=1to1} @pir{r=16}
  
  
tiamatSWARM:
  Skills:
  - orbital{bulletType=MOB;mob=tiamatBAT;onTick=tiamatSWARM-Tick;onHit=tiamatSWARM-Hit;points=20;interval=1;duration=60;charges=1;r=2;rz=90;ry=0}
  - orbital{bulletType=MOB;mob=tiamatBAT;onTick=tiamatSWARM-Tick;onHit=tiamatSWARM-Hit;points=20;interval=1;duration=60;charges=1;rz=90;r=2;ry=45}
  - orbital{bulletType=MOB;mob=tiamatBAT;onTick=tiamatSWARM-Tick;onHit=tiamatSWARM-Hit;points=20;interval=1;duration=60;charges=1;rz=90;r=2;ry=90}
  - orbital{bulletType=MOB;mob=tiamatBAT;onTick=tiamatSWARM-Tick;onHit=tiamatSWARM-Hit;points=20;interval=1;duration=60;charges=1;r=2;rz=90;ry=135}
  - orbital{bulletType=MOB;mob=tiamatBAT;onTick=tiamatSWARM-Tick;onHit=tiamatSWARM-Hit;points=20;interval=1;duration=60;charges=1;rz=90;r=2;ry=180}
  - delay 60
  - remove @self
  
  
  
tiamatSWARM-Hit:
  Skills:
  - damage{a=1}
  - potion{type=SLOW;duration=100;lvl=2}
  
tiamatSWARMBATFX:
  Skills:
  - effect:particles{p=squid_ink;amount=1} @self


tiamatFLINCHHIT:
  Conditions:
  - stance{s=flinch} true
  Skills:
  - state{s=flinch_hit} @self
  
tiamatFLINCH75:
  Conditions:  
  - stance{s=flinch} false
  - offgcd true
  Cooldown: 9999
  Skills:
  - sound{s=littleroom_tiamat:littleroom.tiamat.flinch;v=1;sc=HOSTILE} @self
  - gcd{ticks=110}
  - delay 20
  - summon{t=tiamatConcussion} @ModelPart{m=tiamat;p=head;offset=LOCAL;y=1}
  - setstance{s=flinch} @self
  - state{s=flinch} @self
  - setAI{ai=false;repeat=40;repeatInterval=2} @self
  - delay 50
  - setstance{s=normal} @self
  - delay 40
  - setAI{ai=true} @self
  - delay 5
  - skill{s=tiamatRAGE} @self
  
tiamatFLINCH50:
  Conditions:  
  - stance{s=flinch} false
  - offgcd true
  Cooldown: 9999
  Skills:
  - sound{s=littleroom_tiamat:littleroom.tiamat.flinch;v=1;sc=HOSTILE} @self
  - gcd{ticks=110}
  - CancelEvent
  - delay 20
  - summon{t=tiamatConcussion} @ModelPart{m=tiamat;p=head;offset=LOCAL;y=1}
  - CancelEvent
  - setstance{s=flinch} @self
  - CancelEvent
  - state{s=flinch} @self
  - setAI{ai=false;repeat=40;repeatInterval=2} @self
  - delay 50
  - setstance{s=normal} @self
  - delay 40
  - setAI{ai=true} @self
  - delay 5
  - skill{s=tiamatRAGE} @self
  
  
tiamatFLINCH25:
  Conditions:  
  - stance{s=flinch} false
  - offgcd true
  Cooldown: 9999
  Skills:
  - sound{s=littleroom_tiamat:littleroom.tiamat.flinch;v=1;sc=HOSTILE} @self
  - gcd{ticks=110}
  - CancelEvent
  - delay 20
  - summon{t=tiamatConcussion} @ModelPart{m=tiamat;p=head;offset=LOCAL;y=1}
  - CancelEvent
  - setstance{s=flinch} @self
  - CancelEvent
  - state{s=flinch} @self
  - setAI{ai=false;repeat=40;repeatInterval=2} @self
  - delay 50
  - setstance{s=normal} @self
  - delay 40
  - setAI{ai=true} @self
  - delay 5
  - skill{s=tiamatRAGE} @self
  
tiamatconcussionREMOVE:
  Skills:
  - delay 50
  - remove @self
  
tiamatDEATH:
  Skills:
  - sound{s=littleroom_tiamat:littleroom.tiamat.death;v=1;sc=HOSTILE} @self
  - delay 80
  - effect:particles{p=squid_ink;amount=125;hs=1;vs=1} @self
  - model{mid=tiamat;r=true} @self
  

tiamat_pillar_spawn:
  Skills:
  - delay 1
  - remove @EIR{r=3}
  - setrotation{relative=true;yaw=90} .5
  - setrotation{relative=true;yaw=90} .5
  - setrotation{relative=true;yaw=90} .5
  - setrotation{relative=true;yaw=90} .5
  - setblock{m=BARRIER} @selflocation
  - setblock{m=BARRIER} @selflocation{y=1}
  - setblock{m=BARRIER} @selflocation{y=2}
  - setblock{m=BARRIER} @selflocation{y=3}
  - setblock{m=BARRIER} @selflocation{y=4}
  
tiamat_pillar_break:
  Cooldown: 99999
  Skills:
  - randomskill{skills=tiamatpillar1,tiamatpillar2,tiamatpillar3,tiamatpillar4} @self
  - state{s=break} @self
  - setblock{m=AIR} @selflocation
  - setblock{m=AIR} @selflocation{y=1}
  - setblock{m=AIR} @selflocation{y=2}
  - setblock{m=AIR} @selflocation{y=3}
  - setblock{m=AIR} @selflocation{y=4}
  - setblock{m=AIR} @selflocation{y=5}
  - effect:particles{particle=campfire_cosy_smoke;amount=2;hS=.2;vS=.2;repeat=10;repeatInterval=2} @ModelPart{m=tiamat_pillar;p=pillar_mid}
  - effect:particles{particle=campfire_cosy_smoke;amount=2;hS=.2;vS=.2;repeat=10;repeatInterval=2} @ModelPart{m=tiamat_pillar;p=pillar_top}
  - effect:particles{particle=block;m=stone;amount=5;hS=.2;vS=.2;repeat=10;repeatInterval=2} @ModelPart{m=tiamat_pillar;p=pillar_mid}
  - effect:particles{particle=block;m=stone;amount=5;hS=.2;vS=.2;repeat=10;repeatInterval=2} @ModelPart{m=tiamat_pillar;p=pillar_top}
  - delay 50
  - state{s=break;r=true} @self
  - DefaultState{m=tiamat_pillar;t=IDLE;s=break_idle} @self
  - delay 480
  - state{s=remove_self} @self
  - setblock{m=AIR} @selflocation{y=1}
  - setblock{m=AIR} @selflocation
  - delay 60
  - model{mid=tiamat_pillar;r=true} @self
  
tiamat_pillar_remove:
  TargetConditions:
  - holding{m=BARRIER} true
  Skills:
  - setblock{m=AIR} @selflocation
  - setblock{m=AIR} @selflocation{y=1}
  - setblock{m=AIR} @selflocation{y=2}
  - setblock{m=AIR} @selflocation{y=3}
  - setblock{m=AIR} @selflocation{y=4}
  - setblock{m=AIR} @selflocation{y=5}
  - model{mid=tiamat_pillar;r=true} @self
  